name: CMake build Win x64 Debug

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build_windows:

    runs-on: windows
    steps:
    - uses: actions/checkout@v4
    - name: pull googleTest
      run: git clone https://github.com/google/googletest.git ${{github.workspace}}/dlljbltest/googletest
    - name: configure
      run: cmake -S ${{github.workspace}} ${{github.workspace}}/build
    - name: build
      run: cmake --build ${{github.workspace}}/build
    - name: Create Artifact directory
      run: mkdir artifacts
      working-directory: ${{github.workspace}}
    - name: Upload Test Files
      uses: actions/upload-artifact@v4.6.2
      with:
        name: dlljbl_debug
        path: ${{github.workspace}}/build/dlljbl/Debug/*
    - name: Upload library Files
      uses: actions/upload-artifact@v4.6.2
      with:
        name: dlljbltest_debug
        path: ${{github.workspace}}/build/dlljbltest/Debug/*
    - name: cleanup
      run: Remove-Item -Recurse -Force *;
      working-directory: ${{github.workspace}}
      continue-on-error: true
